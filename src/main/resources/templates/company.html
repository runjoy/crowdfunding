<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="parts/general :: common_header(~{::title})">
    <title th:text="${company.name}"></title>
</head>
<body th:class="${#themes.code('body')}" ng-app="VoteManagement" ng-controller="VoteController">

<div th:replace="parts/general :: navbar"></div>

<div class="container mt-5 p-5 bg-white border">
    <div class="row">
        <div class="col-12 text-right">
            <a class="nav-link" th:if="${show}" th:href="@{'/company/edit/' + ${company.id}}"  th:text="#{company.edit}"></a>

            <input type="hidden" th:ng-init="${'company_id=' + company.id}" ng-value="company_id"/>
            <span class="stars">
                <span th:each="i: ${#numbers.sequence( 1, 5, 1)}" type="checkbox" th:class="'star ' + ${(company.getIntAverageRating()>=i)?'active':' '}" ng-model="companyRatingForm.vote" th:ng-click="${'addVote('+ i + ')'}"></span>
            </span>
            <input type="hidden" th:ng-init="${'rating=' + company.rating}" ng-value="rating"></input>
            <span class="ml-1 align-top unselectable">{{rating}}</span>

        </div>
        <div class="col-12 text-center">
            <h2 class="pb-2" th:text="${company.name}"></h2>
        </div>
        <div class="col-12 text-center">
            <h5 class="pb-4 font-weight-normal" th:text="${company.description}"></h5>
        </div>
    </div>
    <div class="row">
        <div class="col-8">
            <div class="embed-responsive embed-responsive-16by9">
                <iframe class="embed-responsive-item" th:src="${'https://www.youtube.com/embed/' + company.video}" allowfullscreen></iframe>
            </div>
        </div>
        <div class="col-4">
            <h2 th:text="${#numbers.formatDecimal(company.getPledgedSum(), 1, 2) + ' $'}"></h2>
            <p th:text="#{company.collected(${#numbers.formatDecimal(company.goalAmount, 1, 2)})}"></p>
            <div class="progress" style="height: 6px;">
                <div class="progress-bar" role="progressbar" th:style="${'width: ' + company.getPercent() +'%;'}" th:aria-valuenow="${company.getPercent()}" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <p th:text="#{company.finalDate} + ': ' + ${#dates.format(company.finalDate, 'dd/MM/yyyy')}"></p>
            <p class="mt-5 mb-0">
                <a th:href="@{'/profile/' + ${company.owner.id}}">
                    <span th:text="${(company.owner.firstname != null || company.owner.lastname != null)?company.owner.firstname + ' ' + company.owner.lastname:'Anonymous'}"></span>
                </a>
            </p>
            <p class="font-weight-light" th:text="#{profile.created(${company.owner.companies.size()})}"></p>
            <p><img style="width : 20px" src="/img/topic.png" class="mr-1"/><span th:text="#{'topic.' + ${company.topic}}" class="align-bottom"></span></p>
            <p>Tags: <span th:each="tag : ${company.tags}" th:text="${tag.name + ' '}" class="align-bottom"></span></p>
        </div>
    </div>
</div>
<div class="container mt-5 p-5 bg-white border">
    <div class="row">
        <div class="col-8">
            <input type="hidden" id="company-text" th:value="${company.text}"></input>
            <div id="company-text-field"></div>
            <div th:each="comment : ${company.commentList}" class="card mb-3">
                <div class="card-body">
                    <h6 class="card-title" th:text="${comment.author.firstname}"></h6>
                    <p class="card-text" th:text="${comment.text}"></p>
                    <div class="text-right">
                        <form class="d-inline mt-0" th:action="@{/comment/vote}" method="post">
                            <input type="hidden" name="comment" th:value="${comment.id}"/>
                            <label th:text="${comment.getCountLike()}"></label>
                            <input type="hidden" name="vote" value="true"/>
                            <button type="submit" class="btn btn-link"><img style="width : 20px" src="/img/like.png" /></button>
                        </form>
                        <form class="d-inline mt-0" th:action="@{/comment/vote}" method="post">
                            <input type="hidden" name="comment" th:value="${comment.id}"/>
                            <label th:text="${comment.getCountDislike()}"></label>
                            <input type="hidden" name="vote" value="false"/>
                            <button type="submit" class="btn btn-link"><img style="width : 20px" src="/img/dislike.png" /></button>
                        </form>
                    </div>
                </div>
            </div>

                <form th:action="@{'/comment/add/'}" method="post">
                    <div class="form-group pt-5">
                        <h5 th:text="#{comment.add} + ':'"></h5>
                        <input type="text" class="form-control" name="text">
                        <input type="hidden" class="form-control" name="company" th:value="${company.id}">
                    </div>
                    <button type="submit" class="btn btn-primary" th:text="#{comment.add}"></button>
                </form>
        </div>
        <div class="col-4">

            <form th:if="${show}" th:action="@{'/news/add/' + ${company.id}}" method="get">
                <button type="submit" class="btn btn-link mt-2" th:text="#{news.add}"></button>
            </form>

            <div th:each="news : ${company.newsList}">
                <td><a class="nav-link" th:href="@{'/news/' + ${news.id}}" th:text="${news.title}"></a></td>
            </div>

            <form th:if="${show}" th:action="@{'/bonus/add/' + ${company.id}}" method="get">
                <button type="submit" class="btn btn-link mt-2" th:text="#{bonus.add}"></button>
            </form>

            <div th:each="bonus : ${company.bonusList}" class="card mb-3">
                <div class="card-body">
                    <div class="text-right">
                        <a class="d-inline mt-0" th:if="${show}" th:href="@{'/bonus/edit/' + ${bonus.id}}"><img style="width : 20px" src="/img/edit.png" /></a>
                        <form class="d-inline mt-0" th:if="${show}" th:action="@{/bonus/delete}" method="post">
                            <input type="hidden" name="bonus" th:value="${bonus.id}"/>
                            <button type="submit" class="btn btn-link"><img style="width : 20px" src="/img/close.png" /></button>
                        </form>
                    </div>

                    <h5 class="card-title" th:text="${bonus.title}"></h5>
                    <p class="card-text" th:text="${bonus.description}">
                    <p class="card-text" th:text="#{amount} + ': ' + ${#numbers.formatDecimal(bonus.amount, 1, 2)} +' $'"></p>
                    <p class="card-text" th:text="#{bonus.purchased} + ': ' + ${bonus.userList.size()}"></p>
                    </p>
                    <form th:action="@{/bonus/confirmation}" method="post">
                        <input type="hidden" name="bonus" th:value="${bonus.id}"/>
                        <button type="submit" class="btn btn-primary mt-2" th:text="#{buy}"></button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="parts/general :: footer"></div>
<script src="/js/rating.js"></script>

</body>
</html>